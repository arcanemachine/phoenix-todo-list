#!/bin/sh

if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
  echo "Outputs template whose output can be piped to an environment file.

This script is typically run by the 'dotenv-generate' script.

NOTE: To use this script's default values, any matching environment variables
must first be unset.

Optional flags:
  --force - Overwrite an existing dotenv file
  --vagrant - Generate params for deployment in a Vagrant host"
  exit
fi

# parse args
while test $# -gt 0; do
  case "$1" in
  --vagrant)
    # configure environment for deployment in a Vagrant host
    is_vagrant=1
    ;;
  esac
  shift
done

if [ "$is_vagrant" = "1" ]; then
  # configure environment for use with vagrant
  PHX_HOST=phoenix-todo-list.localhost
  TRAEFIK_DASHBOARD_FQDN=localhost
fi

default_phx_host=phoenix-todo-list.localhost

echo "# phoenix
PHX_HOST=\"${PHX_HOST:-$default_phx_host}\"
PORT=\"${PORT:-4000}\"
SECRET_KEY_BASE=\"${SECRET_KEY_BASE:-$(openssl rand -base64 48)}\"

# db
POSTGRES_DB=\"${POSTGRES_DB:-todo_list}\"
POSTGRES_USER=\"${POSTGRES_USER:-postgres}\"
POSTGRES_PASSWORD=\"${POSTGRES_PASSWORD:-postgres}\"
DATABASE_URL=\"${DATABASE_URL:-ecto://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres}@${POSTGRES_HOST:-localhost}/${POSTGRES_DB:-todo_list}}\"

# docker
COMPOSE_PROJECT_NAME=\"${COMPOSE_PROJECT_NAME:-phoenix-todo-list}\"
IMAGE_TAG=\"${IMAGE_TAG:-$(uname -m)}\"

# email
AWS_ACCESS_KEY=\"${AWS_ACCESS_KEY:-your_aws_access_key}\"
AWS_REGION=\"${AWS_REGION:-your_aws_region_eg_us-east-1}\"
AWS_SECRET=\"${AWS_SECRET}\"
EMAIL_FROM_DEFAULT=\"${EMAIL_FROM_DEFAULT:-no-reply@${PHX_HOST:-$default_phx_host}}\"

# sentry
SENTRY_DSN=\"${SENTRY_DSN}\"

# traefik
TRAEFIK_DASHBOARD_FQDN=\"${TRAEFIK_DASHBOARD_FQDN:-localhost}\""
